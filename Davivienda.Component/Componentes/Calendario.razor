@namespace Davivienda.Component.Componentes
@using Davivienda.Models.Modelos

@* Referencia a estilos premium *@
<link href="Calendario.css" rel="stylesheet" />

<div class="calendar-wrapper">
    <div class="calendar-container">
        <div class="calendar-sidebar">
            <div class="mini-calendar">
                <div class="mini-calendar-header">
                    <button class="nav-btn" @onclick="PreviousMonth">‹</button>
                    <h3>@CurrentMonth.ToString("MMMM yyyy")</h3>
                    <button class="nav-btn" @onclick="NextMonth">›</button>
                </div>

                <div class="mini-calendar-grid">
                    <div class="weekday-header">Mon</div>
                    <div class="weekday-header">Tue</div>
                    <div class="weekday-header">Wed</div>
                    <div class="weekday-header">Thu</div>
                    <div class="weekday-header">Fri</div>
                    <div class="weekday-header">Sat</div>
                    <div class="weekday-header">Sun</div>

                    @foreach (var day in GetMonthDays())
                    {
                        <div class="mini-day @(day.IsCurrentMonth ? "" : "other-month") @(day.IsSelected ? "selected" : "") @(day.IsToday ? "today" : "")"
                             @onclick="() => SelectDay(day)">
                            @day.Day
                        </div>
                    }
                </div>
            </div>

            @* Prioridades ocultas visualmente según lo solicitado *@
            <div class="categories-section" style="display: none;">
                <h4>Prioridades</h4>
            </div>
        </div>

        <div class="calendar-main">
            <div class="calendar-header">
                <div class="week-navigation">
                    <button class="nav-btn" @onclick="PreviousWeek">‹</button>
                    <h2>@GetWeekRange()</h2>
                    <button class="nav-btn" @onclick="NextWeek">›</button>
                </div>
                <span class="week-number">Semana @GetWeekNumber()</span>
                <button class="create-btn">+ Crear</button>
            </div>

            <div class="week-days">
                <div class="spacer-cell"></div>
                @foreach (var day in GetWeekDays())
                {
                    <div class="week-day-header">
                        <div class="day-name">@day.ToString("ddd").ToUpper()</div>
                        <div class="day-number @(day.Date == DateTime.Today ? "today" : "")">@day.Day</div>
                    </div>
                }
            </div>

            <div class="time-grid">
                @* Columna de Horas: Ajustada de 8:00 a 16:00 *@
                <div class="time-column">
                    @for (int hour = 8; hour <= 16; hour++)
                    {
                        <div class="time-slot">@hour:00</div>
                    }
                </div>

                @foreach (var day in GetWeekDays())
                {
                    <div class="day-column">
                        @* Celdas de fondo para la cuadrícula *@
                        @for (int hour = 8; hour <= 16; hour++)
                        {
                            <div class="hour-cell"></div>
                        }

                        @if (ListaTareas != null)
                        {
                            @* Renderizado de tareas filtradas por día *@
                            @foreach (var tarea in ListaTareas.Where(t => t.TAR_FEC_INI.Date == day.Date))
                            {
                                <div class="event @GetEventoClase(tarea.PRI_ID)"
                                     @* Usamos .DateTime para resolver el error de tipos previo *@
                                     style="@GetEventoPosicion(tarea.TAR_FEC_INI.DateTime, tarea.TAR_FEC_FIN?.DateTime)">
                                    <div class="event-title">@tarea.TAR_NOM</div>
                                    <div class="event-time">
                                        @tarea.TAR_FEC_INI.ToString("HH:mm") - @(tarea.TAR_FEC_FIN?.ToString("HH:mm") ?? "Límite")
                                    </div>
                                </div>
                            }
                        }
                    </div>
                }
            </div>
        </div>
    </div>
</div>